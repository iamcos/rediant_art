---
export const prerender = false;

// Set Cache-Control headers for Vercel (1 hour)
Astro.response.headers.set(
  "Cache-Control",
  "public, s-maxage=3600, stale-while-revalidate=600",
);

import Layout from "../../layouts/Layout.astro";
import HeroSection from "../../components/HeroSection.astro";
import CallToAction from "../../components/CallToAction.astro";
import ProductGrid from "../../components/ProductGrid.astro";
import { fetchProducts } from "../../utils";

// Fetch products server-side for SEO and ISR
const products = await fetchProducts();

// Filter products by type for better organization
const physicalProducts = products.filter((p) => p.type === "physical");
const digitalProducts = products.filter((p) => p.type === "digital");

// Generate structured data for SEO
const structuredProducts = products.map((product) => ({
  "@type": "Product",
  name: product.name,
  description: product.description,
  image: product.image,
  offers: {
    "@type": "Offer",
    price: product.price,
    priceCurrency: product.currency,
    availability: product.available
      ? "https://schema.org/InStock"
      : "https://schema.org/OutOfStock",
    url: product.link,
  },
  category: product.category,
  brand: {
    "@type": "Brand",
    name: "Rediant Art",
  },
}));

// Breadcrumb structured data
const breadcrumbStructuredData = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Главная",
      item: "https://rediant.art/ru/",
    },
    {
      "@type": "ListItem",
      position: 2,
      name: "Магазин",
      item: "https://rediant.art/ru/shop",
    },
  ],
};

// Collection structured data
const collectionStructuredData = {
  "@context": "https://schema.org",
  "@type": "Collection",
  name: "Коллекция Украшений Rediant Art",
  description:
    "Современные художественные украшения с цепочками для лица, головы, тела и серьгами, созданные с инновациями 3D-печати.",
  url: "https://rediant.art/ru/shop",
  mainEntity: {
    "@type": "ItemList",
    itemListElement: structuredProducts,
  },
  brand: {
    "@type": "Brand",
    name: "Rediant Art",
  },
};
---

<Layout
  title="Магазин - Коллекция Украшений Rediant Art"
  description="Откройте для себя нашу эксклюзивную коллекцию художественных украшений. Цепочки для лица, головы, тела и серьги, созданные с инновациями 3D-печати. Обновлено с последними продуктами."
  lang="ru"
  heroImage="/images/photo_2025-09-10 23.58.23.jpeg"
  heroAlt="Коллекция украшений Rediant Art"
>
  <script
    type="application/ld+json"
    set:html={JSON.stringify(breadcrumbStructuredData)}
  />
  <script
    type="application/ld+json"
    set:html={JSON.stringify(collectionStructuredData)}
  />

  <!-- Hero Section -->
  <HeroSection
    title="Коллекция Магазина"
    subtitle="Эксклюзивные Художественные Украшения"
    description="Откройте для себя нашу уникальную коллекцию цепочек для лица, головы, тела и серег. Каждое изделие создано с точностью и художественным видением."
    backgroundImage="/images/photo_2025-09-10 23.58.23.jpeg"
    backgroundAlt="Коллекция украшений Rediant Art"
    lang="ru"
  />

  <!-- Products Section -->
  <section class="py-20 bg-neutral-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-4xl sm:text-5xl font-bold text-neutral-900 mb-6">
          Наша Коллекция
        </h2>
        <p class="text-xl text-neutral-600 max-w-3xl mx-auto mb-8">
          Ручные украшения, сочетающие древние традиции с современными
          инновациями.
        </p>
        <div class="flex flex-wrap justify-center gap-4 mb-12">
          <span
            class="bg-[var(--color-gold)] text-white px-4 py-2 rounded-full text-sm font-medium"
          >
            {physicalProducts.length} Физических Изделий
          </span>
          <span
            class="bg-[var(--color-charcoal)] text-white px-4 py-2 rounded-full text-sm font-medium"
          >
            {digitalProducts.length} Цифровых Изделий
          </span>
        </div>
      </div>

      <!-- Physical Products -->
      {
        physicalProducts.length > 0 && (
          <div class="mb-16">
            <h3 class="text-3xl font-bold text-neutral-900 mb-8 text-center">
              Физические Украшения
            </h3>
            <ProductGrid
              products={physicalProducts}
              columns={3}
              showEmpty={false}
            />
          </div>
        )
      }

      <!-- Digital Products -->
      {
        digitalProducts.length > 0 && (
          <div class="mb-16">
            <h3 class="text-3xl font-bold text-neutral-900 mb-8 text-center">
              Цифровое Искусство и Дизайны
            </h3>
            <ProductGrid
              products={digitalProducts}
              columns={3}
              showEmpty={false}
            />
          </div>
        )
      }

      <!-- Empty State -->
      {
        products.length === 0 && (
          <div class="text-center py-16">
            <h3 class="text-2xl font-bold text-neutral-900 mb-4">
              Мы в настоящее время обновляем нашу коллекцию
            </h3>
            <p class="text-lg text-neutral-600 mb-8">
              Пожалуйста, проверьте позже для новых художественных украшений!
            </p>
            <a
              href="/ru/contact"
              class="bg-[var(--color-gold)] text-white px-8 py-4 rounded-lg font-semibold hover:bg-[var(--color-charcoal)] transition-colors"
            >
              Связаться с нами
            </a>
          </div>
        )
      }
    </div>
  </section>

  <!-- Call to Action -->
  <CallToAction
    title="Доступны Индивидуальные Заказы"
    description="Не видите именно то, что ищете? Мы создаем индивидуальные изделия, адаптированные под ваше видение. Свяжитесь с нами, чтобы обсудить ваши уникальные потребности в украшениях."
    primaryButton={{
      text: "Запросить Индивидуальное Изделие",
      href: "/ru/contact",
    }}
    secondaryButton={{
      text: "Узнать о Нашем Процессе",
      href: "/ru/about",
    }}
    variant="dark"
  />
</Layout>
