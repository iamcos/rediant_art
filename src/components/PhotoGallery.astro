---
import { getCollection } from "astro:content";

export interface Props {
  category?: string;
  tags?: string[];
  featured?: boolean;
  limit?: number;
  columns?: 2 | 3 | 4;
  showOverlay?: boolean;
}

const {
  category,
  tags = [],
  featured = false,
  limit = 12,
  columns = 3,
  showOverlay = true,
} = Astro.props;

// Get photos from content collection
const photos = await getCollection("photos");

// Filter photos based on props
let filteredPhotos = photos;

if (category) {
  filteredPhotos = filteredPhotos.filter(
    (photo) => photo.data.category === category,
  );
}

if (tags.length > 0) {
  filteredPhotos = filteredPhotos.filter((photo) =>
    tags.some((tag) => photo.data.tags.includes(tag)),
  );
}

if (featured) {
  filteredPhotos = filteredPhotos.filter((photo) => photo.data.featured);
}

// Apply limit
const displayPhotos = filteredPhotos.slice(0, limit);

// Grid columns logic
const gridCols = {
  2: "md:grid-cols-2",
  3: "md:grid-cols-3",
  4: "md:grid-cols-4",
}[columns];
---

<div class={`grid grid-cols-1 ${gridCols} gap-4 p-4`}>
  {
    displayPhotos.map((photo, index) => (
      <div class="group relative overflow-hidden aspect-[4/5] cursor-pointer bg-gray-100">
        <img
          src={`/images/${photo.data.filename}`}
          alt={photo.data.alt}
          loading="lazy"
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
        />
        {showOverlay && (
          <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6">
            <div class="text-white transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 text-left">
              <h3 class="text-lg font-serif mb-1">{photo.data.title}</h3>
              <p class="text-sm font-light opacity-90 mb-2">
                {photo.data.description}
              </p>
              <div class="flex flex-wrap gap-2">
                {photo.data.tags.map((tag) => (
                  <span class="text-xs uppercase tracking-wider border border-white/30 px-2 py-1">
                    {tag}
                  </span>
                ))}
              </div>
            </div>
          </div>
        )}
      </div>
    ))
  }
</div>
