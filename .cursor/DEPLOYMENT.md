# Rediant Art - Vercel Deployment Guide

## Current Status
✅ **DEPLOYED AND WORKING**
- Production URL: https://rediant-art2.vercel.app
- Custom Domain: https://rediant.art (configured)
- Status: Live and functional

## Working Configuration

### Project Setup
- **Framework**: Astro 4.16.19
- **Adapter**: @astrojs/vercel/serverless
- **Output**: hybrid (static + serverless)
- **Node.js**: 18.x (Vercel default, working)

### Key Files
```
vercel.json          # Vercel configuration
astro.config.mjs     # Astro configuration  
package.json         # Dependencies + Node engine
```

### Environment Variables (Production)
```
TRIBUTE_API_KEY      # API key for product fetching
REVALIDATE_SECRET    # Secret for manual revalidation
VERCEL_PROJECT_ID    # Auto-generated by Vercel
```

## Deployment Process

### 1. Git Push (Auto-Deploy)
```bash
git add -A
git commit -m "Your changes"
git push origin main
```
- Vercel automatically builds and deploys on `main` branch push
- Check build status in Vercel dashboard

### 2. Manual Deploy (CLI)
```bash
npm run build        # Test build locally
npx vercel --prod    # Deploy to production
```

### 3. Check Deployment
```bash
npx vercel ls                    # List deployments
npx vercel inspect <deployment>  # Check specific deployment
```

## Configuration Details

### vercel.json
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "astro",
  "regions": ["iad1"],
  "crons": [
    {
      "path": "/api/revalidate",
      "schedule": "0 0 * * *"
    }
  ],
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options", 
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        },
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ],
  "redirects": [
    {
      "source": "/ru",
      "destination": "/ru/",
      "permanent": true
    }
  ]
}
```

### astro.config.mjs
```javascript
export default defineConfig({
  site: 'https://rediant.art',
  base: '/',
  output: 'hybrid',
  integrations: [
    tailwind(),
    sitemap(),
    partytown({
      config: {
        forward: ["dataLayer.push"],
      },
    }),
    vercel(),
  ],
  image: {
    domains: ['rediant.art'],
  },
});
```

### package.json
```json
{
  "engines": {
    "node": ">=18.0.0"
  },
  "dependencies": {
    "@astrojs/partytown": "^2.1.4",
    "@astrojs/sitemap": "^3.0.0", 
    "@astrojs/tailwind": "^5.1.0",
    "@astrojs/vercel": "^6.0.0",
    "astro": "^4.15.0",
    "sharp": "^0.33.5",
    "tailwindcss": "^3.4.0",
    "telegraf": "^4.15.6",
    "zod": "^3.22.4"
  }
}
```

## Troubleshooting

### Common Issues

1. **Runtime Errors**
   - Problem: `nodejs18.x` runtime errors
   - Solution: Use default Vercel runtime (no custom functions config)
   - Status: ✅ Resolved

2. **Build Failures**
   - Check: `npm run build` locally first
   - Verify: All dependencies installed
   - Fix: Update package.json if needed

3. **API Routes**
   - Path: `/api/*` routes in `src/pages/api/`
   - Runtime: Auto-detected by Vercel
   - Status: ✅ Working

### Environment Variables
```bash
# Add new env var
npx vercel env add VARIABLE_NAME production

# List env vars  
npx vercel env ls

# Remove env var
npx vercel env rm VARIABLE_NAME production
```

## Performance Features

### ISR (Incremental Static Regeneration)
- Products fetched from Tribute API at build time
- Daily cron job regenerates at midnight UTC
- Manual revalidation via `/api/revalidate`

### Caching
- Static assets: 1 year cache
- API routes: 5 minute cache
- Images: Long-term cache with immutable

### Security Headers
- X-Content-Type-Options: nosniff
- X-Frame-Options: DENY  
- X-XSS-Protection: 1; mode=block

## Monitoring

### Build Logs
- Check Vercel dashboard for build status
- Monitor API route performance
- Watch for Tribute API integration issues

### Health Checks
- Main site: https://rediant-art2.vercel.app
- API: https://rediant-art2.vercel.app/api/products
- Revalidation: https://rediant-art2.vercel.app/api/revalidate

## Recent Changes

### Contact Form → Messaging CTAs
- ✅ Removed email form
- ✅ Added Telegram direct: @mizyre_keyer
- ✅ Added WhatsApp with prefilled text
- ✅ Bilingual support (EN/RU)

### Background Images
- ✅ Changed from `cover` to `contain`
- ✅ Added `no-repeat` and dark fallback
- ✅ Full image visibility without cropping

### Deployment Fixes
- ✅ Removed problematic functions config
- ✅ Used Vercel auto-detection for runtime
- ✅ Added Node.js engine requirement
- ✅ Working production deployment

## Next Steps

1. **DNS Migration**: Switch from `rediant-art2.vercel.app` to `rediant.art`
2. **AI Chat**: Implement chat assistant with Telegram summaries
3. **Image Optimization**: Convert to WebP/AVIF for better performance
4. **Analytics**: Add performance monitoring

---
*Last Updated: $(date)*
*Status: ✅ Production Ready*
